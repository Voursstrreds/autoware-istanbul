name: autoware_diff_build

on:
  workflow_dispatch:
  push:
    paths:
      - .github/workflows/autoware_diff_build.yml # Self-trigger

jobs:
  autoware-diff-build:
    runs-on: ubuntu-latest
    container: ghcr.io/bounverif/autoware-prebuilt:latest

    steps:
      - name: Cancel previous runs
        uses: styfle/cancel-workflow-action@0.11.0

      # - name: Check out repository
      #   uses: actions/checkout@v3
      #   with:
      #     repository: 'autowarefoundation/autoware'
      #     path: 'autoware'

      # - run: mv autoware /autoware # https://github.com/actions/checkout/issues/197

      - name: Update dependency packages
        run: |
          vcs pull /autoware/src
        shell: bash

      - name: Build
        run: |
          colcon build \
            --base-paths /autoware/src \
            --build-base /build \
            --install-base /install \
            --cmake-args -DCMAKE_BUILD_TYPE=Release \
        shell: bash
